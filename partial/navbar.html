<!-- Navigation -->
<nav class="navbar">
    <div class="container nav-container">
        <a href="#" class="logo">
            <img src="../../partial/persatuan-penduduk-the-strata-bandar-puteri-bangi.png" alt="The Strata Logo"
                style="max-height: 60px; width: auto;">
        </a>
        <div class="mobile-menu-btn">
            <i class="fa-solid fa-bars"></i>
        </div>
        <ul class="nav-links" id="navLinks">
            <li><a href="../Utama/utama.html">Utama</a></li>
            <li class="dropdown-item">
                <a href="../tentang-kami/tentang_kami.html" class="active">Tentang Kami<i
                        class="fa-solid fa-chevron-down" style="font-size: 0.7em;"></i></a>
                <ul class="dropdown-menu">
                    <li><a href="../tentang-kami/tentang_kami.html#maklumat">Maklumat Persatuan</a></li>
                    <li><a href="../tentang-kami/tentang_kami.html#objektif">Objektif Kami</a></li>
                    <li><a href="../tentang-kami/tentang_kami.html#ahli-jk">Ahli Jawatankuasa 24/26</a></li>
                    <li><a href="../tentang-kami/tentang_kami.html#mengapa-penting">Mengapa Persatuan Penduduk
                            Penting?</a></li>
                    <li><a href="../tentang-kami/tentang_kami.html#daftar-ahli">Mengapa Perlu Mendaftar Sebagai
                            Ahli?</a></li>
                </ul>
            </li>
            <li class="dropdown-item">
                <a href="#" class="nav-panduan">Panduan Penduduk <i class="fa-solid fa-chevron-down"
                        style="font-size: 0.7em;"></i></a>
                <ul class="dropdown-menu">
                    <li><a href="../panduan penduduk/panduan_majlis.html">Panduan Majlis</a></li>
                    <li><a href="../panduan penduduk/permohonan_kad_akses & rfid.html">Permohonan Kad Akses & RFID</a>
                    </li>
                    <li><a href="../panduan penduduk/direktori_kecemasan.html">Direktori Kecemasan</a></li>
                    <li><a href="../panduan penduduk/sistem_aduan.html">Sistem Aduan</a></li>
                </ul>
            </li>
            <li><a href="../Pengumuman/pengumuman.html">Pengumuman</a></li>
            <li><a href="../hubungi kami/hubungi_kami.html">Hubungi Kami</a></li>
            <li><a href="../faq/faq.html">FAQ</a></li>

            <!-- Login Link (shown when NOT logged in) -->
            <li id="loginLink"><a href="../login/login.html">Log Masuk</a></li>

            <li><button class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button></li>

            <!-- User Profile Dropdown (shown when logged in) -->
            <li class="user-profile-dropdown" id="userProfileDropdown" style="display: none;">
                <button class="user-icon-btn" id="userIconBtn">
                    <i class="fa-solid fa-user"></i>
                </button>
                <ul class="user-dropdown-menu" id="userDropdownMenu">
                    <li class="user-dropdown-header">
                        <span id="userDisplayName">Pengguna</span>
                    </li>
                    <li><a href="../profile/profile.html"><i class="fa-solid fa-user-circle"></i> Profile</a></li>
                    <li><a href="../pembayaran/pembayaran.html"><i class="fa-solid fa-shield-halved"></i> Pembayaran
                            Sekuriti</a></li>
                    <li class="divider"></li>
                    <li><a href="#" id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Log Keluar</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>

<script>
    // Navbar Show/Hide on Scroll
    let lastScrollTop = 0;
    const navbar = document.querySelector('.navbar');
    const topBar = document.querySelector('.top-bar');

    window.addEventListener('scroll', () => {
        let currentScroll = window.pageYOffset || document.documentElement.scrollTop;

        // Show navbar if at top of page (within 100px) or scrolling up
        if (currentScroll <= 100) {
            navbar.style.transform = 'translateY(0)';
            if (topBar) topBar.style.transform = 'translateY(0)';
        } else if (currentScroll < lastScrollTop) {
            // Scrolling UP - show navbar
            navbar.style.transform = 'translateY(0)';
        } else {
            // Scrolling DOWN - hide navbar
            navbar.style.transform = 'translateY(-100%)';
        }

        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    });

    // =========================================
    // USER AUTHENTICATION STATE
    // =========================================
    // Check if Firebase is loaded (some pages may not have it)
    document.addEventListener('DOMContentLoaded', () => {
        // Wait for Firebase to be ready
        if (typeof firebase !== 'undefined' && typeof onAuthStateChange === 'function') {
            initAuthUI();
        }
    });

    function initAuthUI() {
        const loginLink = document.getElementById('loginLink');
        const userProfileDropdown = document.getElementById('userProfileDropdown');
        const userDisplayName = document.getElementById('userDisplayName');
        const logoutBtn = document.getElementById('logoutBtn');

        onAuthStateChange(async (user) => {
            if (user) {
                // User is logged in - show profile dropdown, hide login link
                if (loginLink) loginLink.style.display = 'none';
                if (userProfileDropdown) userProfileDropdown.style.display = 'block';

                // Get user data and display name
                if (typeof getUserData === 'function') {
                    const userData = await getUserData(user.uid);
                    if (userData.success && userDisplayName) {
                        userDisplayName.textContent = userData.data.nama || user.email || 'Pengguna';
                    }
                }
            } else {
                // User is NOT logged in - show login link, hide profile dropdown
                if (loginLink) loginLink.style.display = 'block';
                if (userProfileDropdown) userProfileDropdown.style.display = 'none';
            }
        });

        // Logout button handler
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                if (typeof logoutUser === 'function') {
                    await logoutUser();
                    window.location.href = '../login/login.html';
                }
            });
        }
    }
</script>